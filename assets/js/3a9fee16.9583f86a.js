"use strict";(self.webpackChunkmy_personal_website=self.webpackChunkmy_personal_website||[]).push([[5837],{1296:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"coreboot/internal/downgrading","title":"Downgrading BIOS","description":"Before we can flash Coreboot internally on a ThinkPad, we need to make sure the BIOS version is vulnerable enough to be overwritten.","source":"@site/docs/coreboot/internal/downgrading.md","sourceDirName":"coreboot/internal","slug":"/coreboot/internal/downgrading-bios/","permalink":"/docs/coreboot/internal/downgrading-bios/","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"coreboot","permalink":"/docs/tags/coreboot"},{"inline":true,"label":"downgrading","permalink":"/docs/tags/downgrading"},{"inline":true,"label":"bios","permalink":"/docs/tags/bios"}],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Downgrading BIOS","slug":"/coreboot/internal/downgrading-bios/","tags":["coreboot","downgrading","bios"]},"sidebar":"tutorialCoreboot","previous":{"title":"Internal Flashing","permalink":"/docs/category/internal-flashing"},"next":{"title":"Unlocking BIOS","permalink":"/docs/coreboot/internal/unlocking-bios/"}}');var s=o(4848),t=o(8453);const r={sidebar_position:1,title:"Downgrading BIOS",slug:"/coreboot/internal/downgrading-bios/",tags:["coreboot","downgrading","bios"]},l="Downgrading BIOS",d={},a=[{value:"Why Downgrade is Possible",id:"why-downgrade-is-possible",level:2},{value:"Performing Downgrade",id:"performing-downgrade",level:2},{value:"Download the BIOS ISO",id:"download-the-bios-iso",level:3},{value:"Extract and Modify the Bootable Image",id:"extract-and-modify-the-bootable-image",level:3},{value:"Modify the Boot Script",id:"modify-the-boot-script",level:3},{value:"Write to a USB Drive",id:"write-to-a-usb-drive",level:3},{value:"Flashing the BIOS",id:"flashing-the-bios",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"downgrading-bios",children:"Downgrading BIOS"})}),"\n",(0,s.jsx)(n.p,{children:"Before we can flash Coreboot internally on a ThinkPad, we need to make sure the BIOS version is vulnerable enough to be overwritten.\nSome newer BIOS versions patch the vulnerabilities that make internal flashing possible, so downgrading may be required."}),"\n",(0,s.jsx)(n.h1,{id:"supported-bios-versions",children:"Supported BIOS Versions"}),"\n",(0,s.jsx)(n.p,{children:"The table below lists the latest BIOS versions that still allow internal flashing.\nIf your BIOS is newer than the version shown, you\u2019ll need to downgrade to that version or an earlier one before installing Coreboot."}),"\n",(0,s.jsx)("div",{class:"fixed-width-table",children:(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Model"}),(0,s.jsx)(n.th,{children:"BIOS Version"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"X230"}),(0,s.jsx)(n.td,{children:"2.60"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"X230T"}),(0,s.jsx)(n.td,{children:"2.58"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"T430"}),(0,s.jsx)(n.td,{children:"2.64"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"T430s"}),(0,s.jsx)(n.td,{children:"2.59"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"T530"}),(0,s.jsx)(n.td,{children:"2.60"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"W530"}),(0,s.jsx)(n.td,{children:"2.58"})]})]})]})}),"\n",(0,s.jsx)(n.h2,{id:"why-downgrade-is-possible",children:"Why Downgrade is Possible"}),"\n",(0,s.jsx)(n.p,{children:"Lenovo claims their BIOS has \u201csecurity rollback prevention,\u201d meaning once you update to a newer version, you can\u2019t go back to an older one.\nIn reality, this restriction is entirely client-side\u2014it\u2019s enforced by Lenovo\u2019s flashing utilities (both the Windows version and the Bootable CD), not the BIOS itself."}),"\n",(0,s.jsx)(n.p,{children:"If you run the flashing program (winflash.exe or dosflash.exe) directly, you can bypass the block. This requires slightly modifying the Bootable CD image you download from Lenovo."}),"\n",(0,s.jsx)(n.h2,{id:"performing-downgrade",children:"Performing Downgrade"}),"\n",(0,s.jsx)(n.p,{children:"We\u2019ll assume your T430s is running a BIOS newer than 2.59. In that case, we\u2019ll downgrade to version 2.59."}),"\n",(0,s.jsx)(n.h3,{id:"download-the-bios-iso",children:"Download the BIOS ISO"}),"\n",(0,s.jsxs)(n.p,{children:["Visit the ",(0,s.jsx)(n.a,{href:"https://support.lenovo.com/us/en/downloads/ds029724-bios-update-utility-bootable-cd-for-windows-10-81-8-7-64-bit-81-8-7-32-bit-xp-thinkpad-t430s-t430si",children:"Lenovo support page for the T430s"})," and find the \u201c",(0,s.jsx)(n.code,{children:"Release (BIOS Bootable)"}),"\u201d column.\nDownload ",(0,s.jsx)(n.code,{children:"g7uj13us.iso"}),", which contains BIOS version 2.59 (you can also choose an even older version if you prefer)."]}),"\n",(0,s.jsx)(n.h3,{id:"extract-and-modify-the-bootable-image",children:"Extract and Modify the Bootable Image"}),"\n",(0,s.jsx)(n.p,{children:"Extract the El Torito image:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"geteltorito -o ./bios.img g1uj41us.iso\n"})}),"\n",(0,s.jsx)(n.p,{children:"Mount the image:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo mount -t vfat ./bios.img /mnt -o loop,offset=16384\n"})}),"\n",(0,s.jsx)(n.p,{children:"List the contents:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ls /mnt\nls /mnt/FLASH\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Inside ",(0,s.jsx)(n.code,{children:"FLASH"}),", you\u2019ll see a directory such as ",(0,s.jsx)(n.code,{children:"G1ET93WW"})," (the name depends on your model and BIOS version).\nCheck what\u2019s inside:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ls /mnt/FLASH/G1ET93WW\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Look for a ",(0,s.jsx)(n.code,{children:".FL1"})," file\u2014something like ",(0,s.jsx)(n.code,{children:"$01D2000.FL1"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"modify-the-boot-script",children:"Modify the Boot Script"}),"\n",(0,s.jsxs)(n.p,{children:["Open ",(0,s.jsx)(n.code,{children:"AUTOEXEC.BAT"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo nano /mnt/AUTOEXEC.BAT\n"})}),"\n",(0,s.jsx)(n.p,{children:"You\u2019ll see something like:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"@ECHO OFF\nPROMPT $p$g\ncd c:\\flash\ncommand.com\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Replace the last line (",(0,s.jsx)(n.code,{children:"command.com"}),") with this (adjust the path to match your ",(0,s.jsx)(n.code,{children:".FL1"})," file):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dosflash.exe /sd /file G1ET93WW\\$01D2000.FL1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Save and unmount:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo umount /mnt\n"})}),"\n",(0,s.jsx)(n.h3,{id:"write-to-a-usb-drive",children:"Write to a USB Drive"}),"\n",(0,s.jsx)(n.p,{children:"Flash the modified image to USB:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo dd if=./bios.img of=/dev/sdX bs=1M\n"})}),"\n",(0,s.jsx)(n.p,{children:"(Replace /dev/sdX with your actual USB device)."}),"\n",(0,s.jsx)(n.h3,{id:"flashing-the-bios",children:"Flashing the BIOS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Enter BIOS settings: Reboot and press ",(0,s.jsx)(n.code,{children:"F1"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"In the Startup tab, set Startup Mode to Legacy (or Both/Legacy First)."}),"\n",(0,s.jsxs)(n.li,{children:["Save and reboot: Press ",(0,s.jsx)(n.code,{children:"F10"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Connect AC power: Do not attempt flashing on battery power. If the system loses power during flashing, you\u2019ll likely need an external programmer to recover."}),"\n",(0,s.jsxs)(n.li,{children:["Boot from USB: Press ",(0,s.jsx)(n.code,{children:"F12"})," during startup, choose the USB drive, and the BIOS flashing will begin automatically."]}),"\n",(0,s.jsx)(n.li,{children:"The process may reboot your laptop several times\u2014do not interrupt it."}),"\n",(0,s.jsx)(n.li,{children:"After completion: Enter BIOS again and set Startup Mode back to UEFI (or Both/UEFI First). This is required for the Coreboot vulnerability to be usable."}),"\n",(0,s.jsxs)(n.li,{children:["Check in your OS: Boot into your operating system and verify that ",(0,s.jsx)(n.code,{children:"/sys/firmware/efi"})," or ",(0,s.jsx)(n.code,{children:"/sys/firmware/efivars"})," exists."]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>l});var i=o(6540);const s={},t=i.createContext(s);function r(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);