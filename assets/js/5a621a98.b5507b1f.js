"use strict";(self.webpackChunkmy_personal_website=self.webpackChunkmy_personal_website||[]).push([[1336],{7008:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>t,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"coreboot/flashing","title":"Flashing","description":"Flashing firmware always carries some risk.","source":"@site/docs/coreboot/flashing.md","sourceDirName":"coreboot","slug":"/coreboot/flashing/","permalink":"/docs/coreboot/flashing/","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"coreboot","permalink":"/docs/tags/coreboot"},{"inline":true,"label":"chipsec","permalink":"/docs/tags/chipsec"},{"inline":true,"label":"bios","permalink":"/docs/tags/bios"},{"inline":true,"label":"flashing","permalink":"/docs/tags/flashing"}],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Flashing","slug":"/coreboot/flashing/","tags":["coreboot","chipsec","bios","flashing"]},"sidebar":"tutorialCoreboot","previous":{"title":"Unlocking BIOS","permalink":"/docs/coreboot/unlocking-bios/"}}');var s=n(4848),r=n(8453);const a={sidebar_position:6,title:"Flashing",slug:"/coreboot/flashing/",tags:["coreboot","chipsec","bios","flashing"]},l="Flashing",t={},c=[{value:"Install Flashing Tools",id:"install-flashing-tools",level:3},{value:"Back Up Your Existing BIOS",id:"back-up-your-existing-bios",level:3},{value:"Prepare the Coreboot BIOS Image",id:"prepare-the-coreboot-bios-image",level:3},{value:"Verify Before Flashing",id:"verify-before-flashing",level:3},{value:"Compare Build Information",id:"compare-build-information",level:3},{value:"Flash the New Coreboot BIOS",id:"flash-the-new-coreboot-bios",level:3},{value:"Verify the Flashed Image",id:"verify-the-flashed-image",level:3}];function h(e){const o={admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.header,{children:(0,s.jsx)(o.h1,{id:"flashing",children:"Flashing"})}),"\n",(0,s.jsx)(o.admonition,{type:"warning",children:(0,s.jsx)(o.p,{children:"Flashing firmware always carries some risk.\nIf something goes wrong, your device might not boot until you reflash it using an external programmer.\nAlways back up your current BIOS before writing Coreboot."})}),"\n",(0,s.jsx)(o.h3,{id:"install-flashing-tools",children:"Install Flashing Tools"}),"\n",(0,s.jsx)(o.p,{children:"We will use the flashrom utility to read and write the BIOS chip, and cbfstool to inspect Coreboot images."}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"sudo apt install coreboot-utils\n"})}),"\n",(0,s.jsx)(o.h3,{id:"back-up-your-existing-bios",children:"Back Up Your Existing BIOS"}),"\n",(0,s.jsx)(o.p,{children:"Before doing anything else, make a full backup of your current BIOS.\nThis is your recovery point if you need to restore the original firmware."}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"sudo flashrom -p internal -r flashed.rom --ifd -i bios\n"})}),"\n",(0,s.jsx)(o.p,{children:"This reads only the BIOS region from the internal programmer and saves it to flashed.rom."}),"\n",(0,s.jsx)(o.h3,{id:"prepare-the-coreboot-bios-image",children:"Prepare the Coreboot BIOS Image"}),"\n",(0,s.jsx)(o.p,{children:"Your compiled coreboot.rom contains more than just the BIOS region, so we must extract only the BIOS part to match the layout of the original firmware."}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"dd if=coreboot.rom of=coreboot_bios.rom bs=1 skip=5242880 count=11534336\n"})}),"\n",(0,s.jsx)(o.p,{children:"Here:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"skip=5242880 skips the first 5 MB (non-BIOS regions such as Intel ME)."}),"\n",(0,s.jsx)(o.li,{children:"count=11534336 copies the remaining 11 MB, which is the BIOS region."}),"\n"]}),"\n",(0,s.jsx)(o.h3,{id:"verify-before-flashing",children:"Verify Before Flashing"}),"\n",(0,s.jsx)(o.p,{children:"Compare file checksums:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"sha1sum coreboot_bios.rom flashed.rom\n"})}),"\n",(0,s.jsx)(o.p,{children:"Check the Coreboot File System (CBFS) contents:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cbfstool coreboot_bios.rom print\ncbfstool flashed.rom print\n"})}),"\n",(0,s.jsx)(o.p,{children:"See the first 20 mismatched bytes (if any):"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cmp -l coreboot_bios.rom flashed.rom | head -n 20\n"})}),"\n",(0,s.jsx)(o.p,{children:"Save CBFS listings to files and compare them:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cbfstool coreboot_bios.rom print > cbfs1.txt\ncbfstool flashed.rom print > cbfs2.txt\ndiff -u cbfs1.txt cbfs2.txt\n"})}),"\n",(0,s.jsx)(o.h3,{id:"compare-build-information",children:"Compare Build Information"}),"\n",(0,s.jsxs)(o.p,{children:["Extract the ",(0,s.jsx)(o.code,{children:"build_info"})," file from each image:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cbfstool coreboot_bios.rom extract -n build_info -f build_info.rom\ncbfstool coreboot.rom extract -n build_info -f build_info.rom\ncbfstool flashed.rom extract -n build_info -f build_info_flashed.rom\n"})}),"\n",(0,s.jsx)(o.p,{children:"Compare them:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"diff -u build_info.rom build_info_flashed.rom\n"})}),"\n",(0,s.jsx)(o.h3,{id:"flash-the-new-coreboot-bios",children:"Flash the New Coreboot BIOS"}),"\n",(0,s.jsx)(o.p,{children:"Once everything looks correct, flash the prepared Coreboot BIOS region:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"sudo flashrom -p internal -w coreboot_bios.rom --ifd -i bios\n"})}),"\n",(0,s.jsx)(o.h3,{id:"verify-the-flashed-image",children:"Verify the Flashed Image"}),"\n",(0,s.jsx)(o.p,{children:"After flashing, always re-read the chip and compare it against the file you wrote.\nThis ensures the flash was successful and the chip contains exactly what you intended."}),"\n",(0,s.jsx)(o.p,{children:"Read back the flashed chip:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"sudo flashrom -p internal -r flashed_after.rom --ifd -i bios\n"})}),"\n",(0,s.jsx)(o.p,{children:"Check CBFS contents:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cbfstool flashed_after.rom print\n"})}),"\n",(0,s.jsx)(o.p,{children:"Compare with the intended Coreboot image:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cmp -l coreboot_bios.rom flashed_after.rom | head -n 20\n"})}),"\n",(0,s.jsx)(o.p,{children:"Optional \u2014 compare CBFS listings in detail:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cbfstool coreboot_bios.rom print > cbfs_final_expected.txt\ncbfstool flashed_after.rom print > cbfs_final_actual.txt\ndiff -u cbfs_final_expected.txt cbfs_final_actual.txt\n"})}),"\n",(0,s.jsx)(o.p,{children:"Optional \u2014 verify build_info after flashing:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"cbfstool flashed_after.rom extract -n build_info -f build_info_after.rom\ndiff -u build_info.rom build_info_after.rom\n"})}),"\n",(0,s.jsx)(o.p,{children:"If all comparisons match, your new Coreboot firmware is flashed correctly."}),"\n",(0,s.jsx)(o.p,{children:"You can now reboot into Coreboot!"})]})}function d(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>a,x:()=>l});var i=n(6540);const s={},r=i.createContext(s);function a(e){const o=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:o},e.children)}}}]);