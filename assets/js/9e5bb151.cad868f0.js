"use strict";(self.webpackChunkmy_personal_website=self.webpackChunkmy_personal_website||[]).push([[8425],{5059:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"libreboot/update","title":"Update","description":"Practical guide: Update. Covers Disable security protections before flashing, Flash Chip Size, Read the Current Chip Contents.","source":"@site/docs/libreboot/update.md","sourceDirName":"libreboot","slug":"/libreboot/update/","permalink":"/docs/libreboot/update/","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"libreboot","permalink":"/docs/tags/libreboot"},{"inline":true,"label":"update","permalink":"/docs/tags/update"},{"inline":true,"label":"flashprog","permalink":"/docs/tags/flashprog"},{"inline":true,"label":"bios","permalink":"/docs/tags/bios"}],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Update","description":"Practical guide: Update. Covers Disable security protections before flashing, Flash Chip Size, Read the Current Chip Contents.","keywords":["bitcoin","self custody","security","privacy","libreboot","update"],"slug":"/libreboot/update/","tags":["libreboot","update","flashprog","bios"]},"sidebar":"tutorialLibreboot","previous":{"title":"Flashing","permalink":"/docs/libreboot/flashing/"}}');var i=s(4848),r=s(8453);const a={sidebar_position:7,title:"Update",description:"Practical guide: Update. Covers Disable security protections before flashing, Flash Chip Size, Read the Current Chip Contents.",keywords:["bitcoin","self custody","security","privacy","libreboot","update"],slug:"/libreboot/update/",tags:["libreboot","update","flashprog","bios"]},o="Update (internal)",l={},d=[{value:"Disable security protections before flashing",id:"disable-security-protections-before-flashing",level:2},{value:"Flash Chip Size",id:"flash-chip-size",level:2},{value:"Read the Current Chip Contents",id:"read-the-current-chip-contents",level:2},{value:"Write the Rom to the Chip",id:"write-the-rom-to-the-chip",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"update-internal",children:"Update (internal)"})}),"\n",(0,i.jsx)(n.p,{children:"Once Libreboot is already installed, you can update to new releases through internal flashing, without needing to disassemble your laptop again."}),"\n",(0,i.jsx)(n.h2,{id:"disable-security-protections-before-flashing",children:"Disable security protections before flashing"}),"\n",(0,i.jsx)(n.p,{children:"Before performing an internal flash, you need to disable the /dev/mem protections. Remember to re-enable them once you\u2019re done."}),"\n",(0,i.jsx)(n.p,{children:"To check if there are any issues, run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo flashprog -p internal\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you don\u2019t get any errors, you can proceed to the Flash Chip Size part."}),"\n",(0,i.jsxs)(n.p,{children:["If you see an error related to ",(0,i.jsx)(n.code,{children:"/dev/mem"})," access, you should restart your system with the ",(0,i.jsx)(n.code,{children:"iomem=relaxed"})," kernel parameter."]}),"\n",(0,i.jsx)(n.p,{children:"To do this just type:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/default/grub\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Find the line starting with ",(0,i.jsx)(n.code,{children:"GRUB_CMDLINE_LINUX_DEFAULT"})," and add ",(0,i.jsx)(n.code,{children:"iomem=relaxed"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'GRUB_CMDLINE_LINUX_DEFAULT="quiet splash iomem=relaxed"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Save the file and update grub:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo update-grub\n"})}),"\n",(0,i.jsx)(n.p,{children:"Reboot the system:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo reboot\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Additionally, use a kernel that does not have the ",(0,i.jsx)(n.code,{children:"CONFIG_STRICT_DEVMEM"})," option enabled. For more detailed instructions, refer to the original guide on the Libreboot website."]}),"\n",(0,i.jsx)(n.h2,{id:"flash-chip-size",children:"Flash Chip Size"}),"\n",(0,i.jsx)(n.p,{children:"To determine the size of your boot flash chip, use the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo flashprog -p internal\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will display information about your boot flash in the output."}),"\n",(0,i.jsx)(n.h2,{id:"read-the-current-chip-contents",children:"Read the Current Chip Contents"}),"\n",(0,i.jsx)(n.p,{children:"To read the current contents of the flash chip, run the below command three times:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo flashprog -p internal:laptop=force_I_want_a_brick,boardmismatch=force -r dump.bin\nsudo flashprog -p internal:laptop=force_I_want_a_brick,boardmismatch=force -r dump2.bin\nsudo flashprog -p internal:laptop=force_I_want_a_brick,boardmismatch=force -r dump3.bin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Next, use ",(0,i.jsx)(n.code,{children:"sha1sum"})," to compare the dumped BIOS images"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sha1sum dump.bin dump2.bin dump3.bin\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the hashes match, you should see something like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"f79eac66c119da200460153019d3d2d5b2c22839  dump.bin\nf79eac66c119da200460153019d3d2d5b2c22839  dump2.bin\nf79eac66c119da200460153019d3d2d5b2c22839  dump3.bin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once you've confirmed that the hashes are the same, you can clean up any temporary dump files:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"rm -fr dump2.bin dump3.bin\n"})}),"\n",(0,i.jsx)(n.h2,{id:"write-the-rom-to-the-chip",children:"Write the Rom to the Chip"}),"\n",(0,i.jsx)(n.p,{children:"To erase and write a new ROM to the flash chip, run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo flashprog -p internal:laptop=force_I_want_a_brick,boardmismatch=force -w libreboot.rom\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: The force_I_want_a_brick option disables safety checks in flashprog. This is necessary in some cases due to changes in flashrom and coreboot over time. If you prefer to avoid this option, try the following:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Start with -p internal."}),"\n",(0,i.jsxs)(n.li,{children:["If that doesn\u2019t work, use -p internal",":boardmismatch","=force."]}),"\n",(0,i.jsxs)(n.li,{children:["If it still doesn't work, use -p internal",":boardmismatch","=force,laptop=force_I_want_a_brick."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"As long as you are using the correct ROM for your machine, it is safe to run these commands. These options simply disable safety checks and are not inherently dangerous."}),"\n",(0,i.jsx)(n.p,{children:'If the flashing is successful, the tool will display "VERIFIED" or indicate that the chip contents are identical to the requested image.'}),"\n",(0,i.jsx)(n.p,{children:"To double-check, you can dump the newly flashed BIOS image by running:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo flashprog -p internal:laptop=force_I_want_a_brick,boardmismatch=force -r new_dump.bin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Next, use ",(0,i.jsx)(n.code,{children:"sha1sum"})," to compare the dumped BIOS image with the original Libreboot ROM file"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sha1sum libreboot.rom new_dump.bin\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the hashes match, you should see something like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"3019da54cea33d2d5b2c228393c009ad20046015  libreboot.rom\n3019da54cea33d2d5b2c228393c009ad20046015  new_dump.bin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once you've confirmed that the hashes are the same, you can clean up any temporary dump files:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"rm -fr new_dump.bin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now you can reboot your laptop with the updated bios!"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);