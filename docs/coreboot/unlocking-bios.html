<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-coreboot/unlocking" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Unlocking BIOS | BTC Self Custody</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://btcselfcustody.io/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://btcselfcustody.io/img/logo.svg"><meta data-rh="true" property="og:url" content="https://btcselfcustody.io/docs/coreboot/unlocking-bios"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Unlocking BIOS | BTC Self Custody"><meta data-rh="true" name="description" content="Before flashing Coreboot internally, it’s important to understand the security protections built into the BIOS and how older versions can be exploited to bypass them."><meta data-rh="true" property="og:description" content="Before flashing Coreboot internally, it’s important to understand the security protections built into the BIOS and how older versions can be exploited to bypass them."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://btcselfcustody.io/docs/coreboot/unlocking-bios"><link data-rh="true" rel="alternate" href="https://btcselfcustody.io/docs/coreboot/unlocking-bios" hreflang="en"><link data-rh="true" rel="alternate" href="https://btcselfcustody.io/docs/coreboot/unlocking-bios" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Unlocking BIOS","item":"https://btcselfcustody.io/docs/coreboot/unlocking-bios/"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DB4LHSKK4J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DB4LHSKK4J",{anonymize_ip:!0})</script>




<script src="https://cloud.umami.is/script.js" defer="defer" data-website-id="5649cb57-bc60-498c-a7ff-2d044fc85912"></script><link rel="stylesheet" href="/assets/css/styles.8912fba2.css">
<script src="/assets/js/runtime~main.b5952886.js" defer="defer"></script>
<script src="/assets/js/main.2badeeb8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="BTC Self Custody" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="BTC Self Custody" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">BTC Self Custody</b></a><a class="navbar__item navbar__link" href="/docs/basics/what-is-self-custody">Basics</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Guides</a><ul class="dropdown__menu"><li class=""><b>Seed</b></li><li><a class="dropdown__link" sidebarid="tutorialSeed" href="/docs/seed">DIY Seed 🎲</a></li><li><a class="dropdown__link" sidebarid="tutorialPassphrase" href="/docs/passphrase">DIY Passphrase 🎲</a></li><li class=""><b>BIOS</b></li><li><a class="dropdown__link" sidebarid="tutorialLibreboot" href="/docs/libreboot">Libreboot</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" sidebarid="tutorialCoreboot" href="/docs/coreboot">Coreboot</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Bitcoin Devices</a><ul class="dropdown__menu"><li><a class="dropdown__link" sidebarid="tutorialBitcoinNode" href="/docs/bitcoin-node">Bitcoin Node</a></li><li><a class="dropdown__link" sidebarid="tutorialBitcoinComputer" href="/docs/bitcoin-computer">Bitcoin Computer</a></li><li><a class="dropdown__link" sidebarid="tutorialAirgappedComputer" href="/docs/air-gapped-computer">Air-Gapped Computer</a></li><li><a class="dropdown__link" sidebarid="tutorialNostrSigningDevice" href="/docs/nostr-signing-device">Nostr Signing Device</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Education</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/books">Books</a></li><li><a class="dropdown__link" href="/podcasts">Podcasts</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://timechainstats.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">TimechainStats<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://mempool.space.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Mempool<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/bitcoin/bips/blob/master/bip-0039/english.txt" target="_blank" rel="noopener noreferrer" class="dropdown__link">BIP39<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><a href="https://github.com/btcselfcustody" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header--github-link" aria-label="GitHub repository"></a><a href="https://orangepill.app.link/btcselfcustody" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header--opa-link" aria-label="Orange Pill App"></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coreboot">Coreboot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coreboot/requirements">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coreboot/build">Build Coreboot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coreboot/downgrading-bios">Downgrading BIOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/coreboot/unlocking-bios">Unlocking BIOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coreboot/internal-flashing">Internal Flashing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coreboot/external-flashing">External Flashing</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Unlocking BIOS</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unlocking BIOS</h1></header>
<p>Before flashing Coreboot internally, it’s important to understand the security protections built into the BIOS and how older versions can be exploited to bypass them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-issues">Security Issues<a href="#security-issues" class="hash-link" aria-label="Direct link to Security Issues" title="Direct link to Security Issues">​</a></h2>
<p>Older factory BIOS versions for these ThinkPad models have multiple security weaknesses, but two of them are especially relevant for installing Coreboot without using an external programmer:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-smm_bwp-and-ble-not-enabled">1. SMM_BWP and BLE not enabled<a href="#1-smm_bwp-and-ble-not-enabled" class="hash-link" aria-label="Direct link to 1. SMM_BWP and BLE not enabled" title="Direct link to 1. SMM_BWP and BLE not enabled">​</a></h3>
<p>In BIOS versions released before 2014, both of these protections (SMM_BWP and BLE) are disabled by default.</p>
<p><strong>Why it matters:</strong> When disabled, the BIOS can be written from the operating system without triggering extra security checks, making internal flashing possible.
Our testing on multiple T430 and X230 BIOS versions confirmed that SMM_BWP = 1 only appears starting from the update whose changelog says:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(New) Improved the UEFI BIOS security feature.</span><br></span></code></pre></div></div>
<p>This change effectively blocks normal internal flashing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-s3-boot-script-vulnerability">2. S3 Boot Script vulnerability<a href="#2-s3-boot-script-vulnerability" class="hash-link" aria-label="Direct link to 2. S3 Boot Script vulnerability" title="Direct link to 2. S3 Boot Script vulnerability">​</a></h3>
<p>This flaw allowed changes to the system’s resume-from-sleep instructions (S3 state). For more info visit this <a href="https://support.lenovo.com/eg/ru/product_security/s3_boot_protect" target="_blank" rel="noopener noreferrer">link</a></p>
<p><strong>Why it matters:</strong> By modifying the boot script, it was possible to disable certain BIOS protections (such as the FLOCKDN bit) after waking from sleep, making the BIOS writable.
This vulnerability was later patched in newer BIOS versions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-chipsec">Install CHIPSEC<a href="#install-chipsec" class="hash-link" aria-label="Direct link to Install CHIPSEC" title="Direct link to Install CHIPSEC">​</a></h2>
<p><a href="https://chipsec.github.io/" target="_blank" rel="noopener noreferrer">CHIPSEC</a> is a framework for analyzing platform level security of hardware, devices, system firmware, low-level protection mechanisms, and the configuration of various platform components.</p>
<p>It contains a set of modules, including simple tests for hardware protections and correct configuration, tests for vulnerabilities in firmware and platform components, security assessment and fuzzing tools for various platform devices and interfaces, and tools acquiring critical firmware and device artifacts.</p>
<p>To install CHIPSEC on your system follow the below steps.</p>
<p>Install the dependencies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install build-essential python3-dev python3 python-is-python3 gcc linux-headers-$(uname -r) nasm</span><br></span></code></pre></div></div>
<p>Clone the CHIPSEC repository on GitHub:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/chipsec/chipsec.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd chipsec</span><br></span></code></pre></div></div>
<p>Build the Driver and Compression Tools</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">python setup.py build_ext -i</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="examining-bios-protections-theory">Examining BIOS Protections (Theory)<a href="#examining-bios-protections-theory" class="hash-link" aria-label="Direct link to Examining BIOS Protections (Theory)" title="Direct link to Examining BIOS Protections (Theory)">​</a></h2>
<p>On Intel platforms, there are two main mechanisms that protect the BIOS chip from being modified:</p>
<ol>
<li><strong>BIOS_CNTL Register</strong></li>
</ol>
<p>Located in the LPC Interface Bridge Registers (accessible through PCI configuration space at offset 0xDC).
It contains the following important bits:</p>
<ul>
<li><strong>SMM_BWP</strong> (SMM BIOS Write Protect) – If set to 1, the BIOS can only be written from System Management Mode (SMM). Once enabled, it cannot be changed.</li>
<li><strong>BLE</strong> (BIOS Lock Enable) – If set to 1, attempting to set BIOSWE to 1 will trigger a System Management Interrupt (SMI). Once enabled, it cannot be changed.</li>
<li><strong>BIOSWE</strong> (BIOS Write Enable) – Controls whether the BIOS is writable. This bit is always read/write.</li>
</ul>
<ol start="2">
<li>SPI Protected Range Registers (<strong>PR0–PR4</strong>)</li>
</ol>
<p>These are part of the SPI Configuration Registers (addresses from SPIBAR + 0x74 to SPIBAR + 0x84).
Each register defines a protected address range and includes a WP (Write Protect) bit, which determines whether writes are blocked for that range.</p>
<ol start="3">
<li><strong>FLOCKDN Bit</strong></li>
</ol>
<p>Found in the HSFS register (<code>SPIBAR + 0x04</code>).
If set to 1, the PR0–PR4 registers are locked and cannot be modified. Once set, it cannot be cleared until a full power cycle reset.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirements-for-flashing">Requirements for Flashing<a href="#requirements-for-flashing" class="hash-link" aria-label="Direct link to Requirements for Flashing" title="Direct link to Requirements for Flashing">​</a></h3>
<p>For internal BIOS flashing to be possible, we ideally need:</p>
<ul>
<li>SMM_BWP = 0</li>
<li>BIOSWE = 1</li>
<li>BLE = 0</li>
<li>FLOCKDN = 0</li>
</ul>
<p>Or, all SPI Protected Range registers (PRx) should have <code>WP = 0</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="checking-current-bios-lock-status">Checking Current BIOS Lock Status<a href="#checking-current-bios-lock-status" class="hash-link" aria-label="Direct link to Checking Current BIOS Lock Status" title="Direct link to Checking Current BIOS Lock Status">​</a></h2>
<p>The goal here is to see whether your BIOS is locked against internal writes. We do this by inspecting certain chipset registers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-check-the-hsfs-register">Step 1: Check the HSFS Register<a href="#step-1-check-the-hsfs-register" class="hash-link" aria-label="Direct link to Step 1: Check the HSFS Register" title="Direct link to Step 1: Check the HSFS Register">​</a></h3>
<p>Run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_main.py -m common.spi_lock</span><br></span></code></pre></div></div>
<p>This will display the Hardware Sequencing Flash Status (HSFS) register, located at <code>SPIBAR + 0x04</code>.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Output</summary><div><div class="collapsibleContent_i85q"><p></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ Module: SPI Flash Controller Configuration Locks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] HSFS = 0xE009 &lt;&lt; Hardware Sequencing Flash Status Register (SPIBAR + 0x4)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [00] FDONE            = 1 &lt;&lt; Flash Cycle Done</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [01] FCERR            = 0 &lt;&lt; Flash Cycle Error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [02] AEL              = 0 &lt;&lt; Access Error Log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [03] BERASE           = 1 &lt;&lt; Block/Sector Erase Size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [05] SCIP             = 0 &lt;&lt; SPI cycle in progress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [13] FDOPSS           = 1 &lt;&lt; Flash Descriptor Override Pin-Strap Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [14] FDV              = 1 &lt;&lt; Flash Descriptor Valid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [15] FLOCKDN          = 1 &lt;&lt; Flash Configuration Lock-Down</span><br></span></code></pre></div></div><p></p></div></div></details>
<p>One of the most important bits here is:</p>
<p><strong>FLOCKDN (bit 15)</strong>: “Flash Configuration Lock-Down.”</p>
<ul>
<li>1 = Locked. You cannot change the SPI Protected Range (PR0–PR4) registers until the next hardware reset.</li>
<li>0 = Unlocked. You can edit the PR registers and remove write protection.</li>
</ul>
<p>If you see:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FLOCKDN = 1</span><br></span></code></pre></div></div>
<p>It means the SPI configuration is locked. We’ll need to bypass this later if we want to disable write protection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-check-bios_cntl-and-protected-ranges-pr0pr4">Step 2: Check BIOS_CNTL and Protected Ranges (PR0–PR4)<a href="#step-2-check-bios_cntl-and-protected-ranges-pr0pr4" class="hash-link" aria-label="Direct link to Step 2: Check BIOS_CNTL and Protected Ranges (PR0–PR4)" title="Direct link to Step 2: Check BIOS_CNTL and Protected Ranges (PR0–PR4)">​</a></h3>
<p>Run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_main.py -m common.bios_wp</span><br></span></code></pre></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Output</summary><div><div class="collapsibleContent_i85q"><p></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [x][ Module: BIOS Region Write Protection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [*] BC = 0x 8 &lt;&lt; BIOS Control (b:d.f 00:31.0 + 0xDC)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     [00] BIOSWE           = 0 &lt;&lt; BIOS Write Enable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     [01] BLE              = 0 &lt;&lt; BIOS Lock Enable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     [02] SRC              = 2 &lt;&lt; SPI Read Configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     [04] TSS              = 0 &lt;&lt; Top Swap Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     [05] SMM_BWP          = 0 &lt;&lt; SMM BIOS Write Protection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [-] BIOS region write protection is disabled!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [*] BIOS Region: Base = 0x00500000, Limit = 0x00BFFFFF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> SPI Protected Ranges</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PRx (offset) | Value    | Base     | Limit    | WP? | RP?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PR0 (74)     | 00000000 | 00000000 | 00000000 | 0   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PR1 (78)     | 8BFF0B40 | 00B40000 | 00BFFFFF | 1   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PR2 (7C)     | 8B100B10 | 00B10000 | 00B10FFF | 1   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PR3 (80)     | 8ADE0AD0 | 00AD0000 | 00ADEFFF | 1   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PR4 (84)     | 8AAF0800 | 00800000 | 00AAFFFF | 1   | 0</span><br></span></code></pre></div></div><p></p></div></div></details>
<ul>
<li><strong>Good:</strong> On older BIOS versions, <code>SMM_BWP = 0</code> and <code>BLE = 0</code>.</li>
<li><strong>Bad:</strong> PR1–PR4 have <code>WP = 1</code>, meaning large portions of the BIOS region are write-protected even though BIOS_CNTL itself looks permissive.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-looking-at-the-raw-registers-optional">Step 3: Looking at the Raw Registers (Optional)<a href="#step-3-looking-at-the-raw-registers-optional" class="hash-link" aria-label="Direct link to Step 3: Looking at the Raw Registers (Optional)" title="Direct link to Step 3: Looking at the Raw Registers (Optional)">​</a></h3>
<p>Another way to examine SPI configuration registers is to dump the raw-mapped SPIBAR register space directly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_util.py mmio dump SPIBAR</span><br></span></code></pre></div></div>
<p>This will show:</p>
<ul>
<li>The base address of SPIBAR (e.g., <code>0xFED1F800</code>)</li>
<li>All register values, including <code>0x0004E009</code> at offset <code>0x04</code> (HSFS)</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[mmio] MMIO register range [0x00000000FED1F800:0x00000000FED1F800+00000200]:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+00000000: 0BFF0500</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+00000004: 0004E009</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-matters">Why This Matters<a href="#why-this-matters" class="hash-link" aria-label="Direct link to Why This Matters" title="Direct link to Why This Matters">​</a></h3>
<p>In theory, to flash the BIOS internally, you’d just clear the WP bits in <code>PR0–PR4.</code>
But if <code>FLOCKDN = 1</code> in HSFS, the chipset won’t let you change those registers until the next hardware reset (and firmware will usually lock it again at boot).</p>
<p>That’s why the later steps in the guide focus on modifying the S3 boot script—to stop the firmware from setting <code>FLOCKDN = 1</code> during resume, so we can remove the <code>WP</code> bits.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="removing-protections-practice">Removing Protections (Practice)<a href="#removing-protections-practice" class="hash-link" aria-label="Direct link to Removing Protections (Practice)" title="Direct link to Removing Protections (Practice)">​</a></h2>
<p>Normally, the FLOCKDN bit (which locks the SPI configuration) can only be cleared by a full hardware reset.
This reset happens not only on a full reboot, but also when waking the computer from S3 sleep (suspend to RAM).</p>
<p>When the system wakes from S3, the chipset restores all its settings by running a set of instructions called S3 Boot Scripts.
These scripts are stored in RAM, which means we can edit them before waking—and change what the firmware does during resume.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-dump-the-s3-boot-script">Step 1: Dump the S3 Boot Script<a href="#step-1-dump-the-s3-boot-script" class="hash-link" aria-label="Direct link to Step 1: Dump the S3 Boot Script" title="Direct link to Step 1: Dump the S3 Boot Script">​</a></h3>
<p>Run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_util.py uefi s3bootscript</span><br></span></code></pre></div></div>
<p>This lists many entries. Look for one that writes to the HSFS register (<code>SPIBAR + 0x04</code>).
If your <code>SPIBAR</code> address is <code>0xFED1F800</code>, that’s <code>0xFED1F804</code> for HSFS.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Output</summary><div><div class="collapsibleContent_i85q"><p></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Entry at offset 0x2B8F (len = 0x17, header len = 0x0):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Data:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 02 00 17 02 00 00 00 01 00 00 00 04 f8 d1 fe 00 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 00 00 00 09 e0 04 00                            |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Decoded:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Opcode : S3_BOOTSCRIPT_MEM_WRITE (0x0002)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Width  : 0x02 (4 bytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Address: 0xFED1F804</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Count  : 0x1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Values : 0x0004E009</span><br></span></code></pre></div></div><p></p></div></div></details>
<p>That <code>0x0004E009</code> value sets <code>FLOCKDN = 1</code>, which we don’t want.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-back-up-your-bios-region-important">Step 2: Back Up Your BIOS Region (Important!)<a href="#step-2-back-up-your-bios-region-important" class="hash-link" aria-label="Direct link to Step 2: Back Up Your BIOS Region (Important!)" title="Direct link to Step 2: Back Up Your BIOS Region (Important!)">​</a></h3>
<p>Before making changes, back up the BIOS region so you can recover if something goes wrong.
To create a reliable backup of the BIOS chip(s), it&#x27;s advisable to perform a triple dump of them</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo flashrom -p internal -r bios_backup.rom --ifd -i bios</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo flashrom -p internal -r bios_backup2.rom --ifd -i bios</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo flashrom -p internal -r bios_backup3.rom --ifd -i bios</span><br></span></code></pre></div></div>
<p>Next, use sha1sum to compare the dumped BIOS images</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sha1sum bios_backup.bin bios_backup2.bin bios_backup3.bin</span><br></span></code></pre></div></div>
<p>If the hashes match, you should see something like this:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">6cf9bfc90df1ed01336872cd159a00c101d0a7b0  bios_backup.bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6cf9bfc90df1ed01336872cd159a00c101d0a7b0  bios_backup2.bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6cf9bfc90df1ed01336872cd159a00c101d0a7b0  bios_backup3.bin</span><br></span></code></pre></div></div>
<p>Once you&#x27;ve confirmed that the hashes are the same, you can clean up any temporary dump files:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">rm -fr bios_backup2.bin bios_backup3.bin</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-patch-the-boot-script">Step 3: Patch the Boot Script<a href="#step-3-patch-the-boot-script" class="hash-link" aria-label="Direct link to Step 3: Patch the Boot Script" title="Direct link to Step 3: Patch the Boot Script">​</a></h3>
<p>We’ll modify the script so it writes <code>0x6009</code> instead of <code>0xE009</code> to HSFS.
This clears bit 15 (<code>FLOCKDN</code>), leaving it unlocked after resume.</p>
<p>Run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_main.py -m tools.uefi.s3script_modify -a replace_op,mmio_wr,0xFED1F804,0x6009,0x2</span><br></span></code></pre></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Output</summary><div><div class="collapsibleContent_i85q"><p></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [*] Modifying S3 boot script entry at address 0x00000000DAF49B8F..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [mem] 0x00000000DAF49B8F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [*] Original entry:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2  0 17  2  0  0  0  1  0  0  0  4 f8 d1 fe  0 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0  0  0  9 e0  4  0                            |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [mem] buffer len = 0x17 to PA = 0x00000000DAF49B8F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2  0 17  2  0  0  0  1  0  0  0  4 f8 d1 fe  0 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0  0  0  9 60  0  0                            |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [mem] 0x00000000DAF49B8F</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [*] Modified entry:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2  0 17  2  0  0  0  1  0  0  0  4 f8 d1 fe  0 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0  0  0  9 60  0  0                            | </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [*] After sleep/resume, check the value of register 0xFED1F804 is 0x6009</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [+] PASSED: The script has been modified. Go to sleep..</span><br></span></code></pre></div></div><p></p></div></div></details>
<p>If successful, you’ll see at the end of the logs a “Modified entry” output with the new <code>0x6009</code> value:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-apply-the-patch-by-sleeping-and-resuming">Step 4: Apply the Patch by Sleeping and Resuming<a href="#step-4-apply-the-patch-by-sleeping-and-resuming" class="hash-link" aria-label="Direct link to Step 4: Apply the Patch by Sleeping and Resuming" title="Direct link to Step 4: Apply the Patch by Sleeping and Resuming">​</a></h3>
<ul>
<li>Put your machine into S3 sleep (suspend)</li>
<li>Wake it back up</li>
<li>Check if <code>FLOCKDN</code> is now 0:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_main.py -m common.spi_lock</span><br></span></code></pre></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Output</summary><div><div class="collapsibleContent_i85q"><p></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ Module: SPI Flash Controller Configuration Locks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] HSFS = 0x6008 &lt;&lt; Hardware Sequencing Flash Status Register (SPIBAR + 0x4)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [00] FDONE            = 0 &lt;&lt; Flash Cycle Done</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [01] FCERR            = 0 &lt;&lt; Flash Cycle Error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [02] AEL              = 0 &lt;&lt; Access Error Log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [03] BERASE           = 1 &lt;&lt; Block/Sector Erase Size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [05] SCIP             = 0 &lt;&lt; SPI cycle in progress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [13] FDOPSS           = 1 &lt;&lt; Flash Descriptor Override Pin-Strap Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [14] FDV              = 1 &lt;&lt; Flash Descriptor Valid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [15] FLOCKDN          = 0 &lt;&lt; Flash Configuration Lock-Down</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] SPI Flash Controller configuration is not locked</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] FAILED: SPI Flash Controller not locked correctly.</span><br></span></code></pre></div></div><p></p></div></div></details>
<p>If you see:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[15] FLOCKDN = 0 &lt;&lt; Flash Configuration Lock-Down</span><br></span></code></pre></div></div>
<p>...then it’s unlocked.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-remove-write-protection-from-bios-ranges">Step 5: Remove Write Protection from BIOS Ranges<a href="#step-5-remove-write-protection-from-bios-ranges" class="hash-link" aria-label="Direct link to Step 5: Remove Write Protection from BIOS Ranges" title="Direct link to Step 5: Remove Write Protection from BIOS Ranges">​</a></h3>
<p>Now that <code>FLOCKDN</code> is cleared, we can disable write protection (WP) on all protected ranges:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_util.py mmio write SPIBAR 0x74 0x4 0x0AAF0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_util.py mmio write SPIBAR 0x78 0x4 0x0ADE0AD0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_util.py mmio write SPIBAR 0x7C 0x4 0x0B100B10</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_util.py mmio write SPIBAR 0x80 0x4 0x0BFF0B40</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-verify">Step 6: Verify<a href="#step-6-verify" class="hash-link" aria-label="Direct link to Step 6: Verify" title="Direct link to Step 6: Verify">​</a></h3>
<p>Check again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo python chipsec_main.py -m common.bios_wp</span><br></span></code></pre></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Output</summary><div><div class="collapsibleContent_i85q"><p></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ Module: BIOS Region Write Protection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[x][ =======================================================================</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] BC = 0x 9 &lt;&lt; BIOS Control (b:d.f 00:31.0 + 0xDC)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [00] BIOSWE           = 1 &lt;&lt; BIOS Write Enable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [01] BLE              = 0 &lt;&lt; BIOS Lock Enable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [02] SRC              = 2 &lt;&lt; SPI Read Configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [04] TSS              = 0 &lt;&lt; Top Swap Status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [05] SMM_BWP          = 0 &lt;&lt; SMM BIOS Write Protection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] BIOS region write protection is disabled!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] BIOS Region: Base = 0x00500000, Limit = 0x00BFFFFF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SPI Protected Ranges</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PRx (offset) | Value    | Base     | Limit    | WP? | RP?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">------------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PR0 (74)     | 0AAF0800 | 00800000 | 00AAF000 | 0   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PR1 (78)     | 0ADE0AD0 | 00AD0000 | 00ADE000 | 0   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PR2 (7C)     | 0B100B10 | 00B10000 | 00B10000 | 0   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PR3 (80)     | 0BFF0B40 | 00B40000 | 00BFF000 | 0   | 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PR4 (84)     | 00000000 | 00000000 | 00000000 | 0   | 0</span><br></span></code></pre></div></div><p></p></div></div></details>
<p>If all <code>WP?</code> values are now 0, the BIOS region is fully writable.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-7-flash-internally">Step 7: Flash Internally<a href="#step-7-flash-internally" class="hash-link" aria-label="Direct link to Step 7: Flash Internally" title="Direct link to Step 7: Flash Internally">​</a></h3>
<p>You can now flash Coreboot or a modified BIOS:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo flashrom -p internal -w coreboot.rom --ifd -i bios -N</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Important</div><div class="admonitionContent_BuS1"><p>Only flash the BIOS region (--ifd -i bios). The FD and ME regions are still locked.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/coreboot">coreboot</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/chipsec">chipsec</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/bios">bios</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/tags/unlocking">unlocking</a></li></ul></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/coreboot/downgrading-bios"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Downgrading BIOS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/coreboot/internal-flashing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Internal Flashing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#security-issues" class="table-of-contents__link toc-highlight">Security Issues</a><ul><li><a href="#1-smm_bwp-and-ble-not-enabled" class="table-of-contents__link toc-highlight">1. SMM_BWP and BLE not enabled</a></li><li><a href="#2-s3-boot-script-vulnerability" class="table-of-contents__link toc-highlight">2. S3 Boot Script vulnerability</a></li></ul></li><li><a href="#install-chipsec" class="table-of-contents__link toc-highlight">Install CHIPSEC</a></li><li><a href="#examining-bios-protections-theory" class="table-of-contents__link toc-highlight">Examining BIOS Protections (Theory)</a><ul><li><a href="#requirements-for-flashing" class="table-of-contents__link toc-highlight">Requirements for Flashing</a></li></ul></li><li><a href="#checking-current-bios-lock-status" class="table-of-contents__link toc-highlight">Checking Current BIOS Lock Status</a><ul><li><a href="#step-1-check-the-hsfs-register" class="table-of-contents__link toc-highlight">Step 1: Check the HSFS Register</a></li><li><a href="#step-2-check-bios_cntl-and-protected-ranges-pr0pr4" class="table-of-contents__link toc-highlight">Step 2: Check BIOS_CNTL and Protected Ranges (PR0–PR4)</a></li><li><a href="#step-3-looking-at-the-raw-registers-optional" class="table-of-contents__link toc-highlight">Step 3: Looking at the Raw Registers (Optional)</a></li><li><a href="#why-this-matters" class="table-of-contents__link toc-highlight">Why This Matters</a></li></ul></li><li><a href="#removing-protections-practice" class="table-of-contents__link toc-highlight">Removing Protections (Practice)</a><ul><li><a href="#step-1-dump-the-s3-boot-script" class="table-of-contents__link toc-highlight">Step 1: Dump the S3 Boot Script</a></li><li><a href="#step-2-back-up-your-bios-region-important" class="table-of-contents__link toc-highlight">Step 2: Back Up Your BIOS Region (Important!)</a></li><li><a href="#step-3-patch-the-boot-script" class="table-of-contents__link toc-highlight">Step 3: Patch the Boot Script</a></li><li><a href="#step-4-apply-the-patch-by-sleeping-and-resuming" class="table-of-contents__link toc-highlight">Step 4: Apply the Patch by Sleeping and Resuming</a></li><li><a href="#step-5-remove-write-protection-from-bios-ranges" class="table-of-contents__link toc-highlight">Step 5: Remove Write Protection from BIOS Ranges</a></li><li><a href="#step-6-verify" class="table-of-contents__link toc-highlight">Step 6: Verify</a></li><li><a href="#step-7-flash-internally" class="table-of-contents__link toc-highlight">Step 7: Flash Internally</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Guides</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/seed">DIY Seed</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/libreboot">Libreboot</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/bitcoin-node">Bitcoin Node</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Devices</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/bitcoin-computer">Bitcoin computer</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/air-gapped-computer">Air-gapped computer</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/nostr-signing-device">Nostr Signing Device</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Find Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/btcselfcustody" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://keybase.io/btcselfcustody" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://orangepill.app.link/btcselfcustody" target="_blank" rel="noopener noreferrer" class="footer__link-item">Orange Pill App<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 BTC Self Custody. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>